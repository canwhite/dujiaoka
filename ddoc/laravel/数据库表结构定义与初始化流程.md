# æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰ä¸åˆå§‹åŒ–æµç¨‹

## ä¸€ã€æ•°æ®è¡¨ç»“æ„å®šä¹‰ä½ç½®

### ğŸ“ æ–‡ä»¶è·¯å¾„
```
database/sql/install.sql
```

**è¯´æ˜**: æœ¬é¡¹ç›®**ä¸ä½¿ç”¨** Laravel æ ‡å‡†çš„ Migrations,è€Œæ˜¯ä½¿ç”¨**åŸç”Ÿ SQL æ–‡ä»¶**å®šä¹‰è¡¨ç»“æ„ã€‚

---

## äºŒã€åˆå§‹åŒ–æµç¨‹ä¸è°ƒç”¨é¡ºåº

### ğŸ”¢ å®Œæ•´è°ƒç”¨é“¾è·¯

```
1. ç”¨æˆ·è®¿é—®ç½‘ç«™
   â†“
2. InstallCheck ä¸­é—´ä»¶ (app/Http/Middleware/InstallCheck.php:19)
   - æ£€æŸ¥ install.lock æ˜¯å¦å­˜åœ¨
   - ä¸å­˜åœ¨ â†’ å…è®¸è®¿é—®å®‰è£…é¡µé¢
   - å­˜åœ¨ â†’ é‡å®šå‘åˆ°é¦–é¡µ
   â†“
3. è·¯ç”±é…ç½® (routes/common/web.php:37-42)
   Route::get('install', 'HomeController@install');
   Route::post('do-install', 'HomeController@doInstall');
   â†“
4. æ˜¾ç¤ºå®‰è£…è¡¨å• (app/Http/Controllers/Home/HomeController.php:122)
   return view('common/install');
   - ç”¨æˆ·å¡«å†™: æ•°æ®åº“é…ç½®ã€Redis é…ç½®
   â†“
5. æäº¤å®‰è£… (POST /do-install)
   HomeController@doInstall (ç¬¬135-189è¡Œ)
   â†“
6. æµ‹è¯•è¿æ¥ (ç¬¬157-160è¡Œ)
   - DB::connection()->select('select 1')  # æµ‹è¯• MySQL
   - Redis::set('dujiaoka_com', 'ok')      # æµ‹è¯• Redis
   â†“
7. ç”Ÿæˆ .env æ–‡ä»¶ (ç¬¬176è¡Œ)
   - è¯»å– .env.example æ¨¡æ¿
   - æ›¿æ¢å ä½ç¬¦ä¸ºç”¨æˆ·é…ç½®
   - ç”Ÿæˆ APP_KEY
   - å†™å…¥ .env
   â†“
8. â­ å¯¼å…¥æ•°æ®åº“è¡¨ç»“æ„ (ç¬¬178è¡Œ)
   DB::unprepared(file_get_contents($installSql));
   â†“
   è¯»å–: database/sql/install.sql
   â†“
   æ‰§è¡Œæ‰€æœ‰ CREATE TABLE è¯­å¥
   â†“
   æ’å…¥åˆå§‹æ•°æ® (é»˜è®¤ç®¡ç†å‘˜ã€èœå•ã€æƒé™ç­‰)
   â†“
9. åˆ›å»ºå®‰è£…é” (ç¬¬180è¡Œ)
   file_put_contents($installLock, 'install ok');
   â†“
10. å®‰è£…å®Œæˆ,è¿”å› success
```

---

## ä¸‰ã€æ•°æ®åº“è¡¨æ¸…å• (19å¼ è¡¨)

### ğŸ“Š è¡¨åˆ†ç±»ç»Ÿè®¡

| æ¨¡å— | è¡¨æ•°é‡ | è¡¨å |
|------|--------|------|
| **æƒé™ç®¡ç†** | 7å¼  | admin_menu, admin_users, admin_roles, admin_permissions,<br>admin_role_users, admin_role_permissions, admin_role_menu |
| **å•†å“ç®¡ç†** | 3å¼  | goods, goods_group, carmis |
| **è®¢å•ç®¡ç†** | 1å¼  | orders |
| **ä¼˜æƒ ç ** | 2å¼  | coupons, coupons_goods |
| **æ”¯ä»˜é…ç½®** | 1å¼  | pays |
| **é‚®ä»¶æ¨¡æ¿** | 1å¼  | emailtpls |
| **ç³»ç»Ÿé…ç½®** | 3å¼  | admin_settings, failed_jobs, migrations |

---

## å››ã€æ ¸å¿ƒè¡¨ç»“æ„è¯¦è§£

### 1. æƒé™ç®¡ç†ç³»ç»Ÿ (RBAC)

#### è¡¨å…³ç³»å›¾
```
admin_users (ç®¡ç†å‘˜ç”¨æˆ·)
    â†“ many-to-many
admin_roles (è§’è‰²)
    â†“ many-to-many
admin_permissions (æƒé™)

admin_roles â† many-to-many â†’ admin_menu (èœå•)
```

#### admin_users - ç®¡ç†å‘˜è¡¨
```sql
CREATE TABLE `admin_users` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(120) NOT NULL,        -- ç”¨æˆ·å (å”¯ä¸€)
  `password` varchar(80) NOT NULL,         -- å¯†ç  (bcrypt åŠ å¯†)
  `name` varchar(255) NOT NULL,            -- æ˜µç§°
  `avatar` varchar(255) DEFAULT NULL,      -- å¤´åƒ URL
  `remember_token` varchar(100) DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `admin_users_username_unique` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- é»˜è®¤ç®¡ç†å‘˜ (install.sql ç¬¬214è¡Œ)
-- username: admin
-- password: admin (åŠ å¯†å: $2y$10$e7z99Mhxm9BOHL55xHZTx.QcNTZJC6ftRXHCR/ZkBja/jBeasVeBy)
```

#### admin_roles - è§’è‰²è¡¨
```sql
CREATE TABLE `admin_roles` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,             -- è§’è‰²åç§°
  `slug` varchar(50) NOT NULL,             -- è§’è‰²æ ‡è¯† (å”¯ä¸€)
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `admin_roles_slug_unique` (`slug`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- é»˜è®¤è§’è‰²: Administrator
```

#### admin_permissions - æƒé™è¡¨
```sql
CREATE TABLE `admin_permissions` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,             -- æƒé™åç§°
  `slug` varchar(50) NOT NULL,             -- æƒé™æ ‡è¯† (å”¯ä¸€)
  `http_method` varchar(255) DEFAULT NULL, -- HTTP æ–¹æ³• (GET/POST/PUT/DELETE)
  `http_path` text DEFAULT NULL,           -- HTTP è·¯å¾„ (æ”¯æŒé€šé…ç¬¦)
  `order` int NOT NULL DEFAULT '0',        -- æ’åº
  `parent_id` bigint NOT NULL DEFAULT '0', -- çˆ¶çº§æƒé™ ID
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `admin_permissions_slug_unique` (`slug`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### å…³è”è¡¨
```sql
-- ç”¨æˆ·-è§’è‰²å…³è”
CREATE TABLE `admin_role_users` (
  `role_id` bigint NOT NULL,
  `user_id` bigint NOT NULL,
  UNIQUE KEY (`role_id`, `user_id`)
);

-- è§’è‰²-æƒé™å…³è”
CREATE TABLE `admin_role_permissions` (
  `role_id` bigint NOT NULL,
  `permission_id` bigint NOT NULL,
  UNIQUE KEY (`role_id`, `permission_id`)
);

-- è§’è‰²-èœå•å…³è”
CREATE TABLE `admin_role_menu` (
  `role_id` bigint NOT NULL,
  `menu_id` bigint NOT NULL,
  UNIQUE KEY (`role_id`, `menu_id`)
);
```

---

### 2. å•†å“ç®¡ç†æ¨¡å—

#### goods - å•†å“è¡¨
```sql
CREATE TABLE `goods` (
  `id` int NOT NULL AUTO_INCREMENT,
  `group_id` int NOT NULL,                 -- æ‰€å±åˆ†ç±» ID
  `gd_name` varchar(200) NOT NULL,         -- å•†å“åç§°
  `gd_description` varchar(200) NOT NULL,  -- å•†å“æè¿°
  `gd_keywords` varchar(200) NOT NULL,     -- SEO å…³é”®å­—
  `picture` text,                          -- å•†å“å›¾ç‰‡ URL
  `retail_price` decimal(10,2) DEFAULT '0.00',  -- é›¶å”®ä»· (å±•ç¤ºç”¨)
  `actual_price` decimal(10,2) NOT NULL DEFAULT '0.00',  -- å®é™…å”®ä»·
  `in_stock` int NOT NULL DEFAULT '0',     -- åº“å­˜æ•°é‡
  `sales_volume` int DEFAULT '0',          -- é”€é‡
  `ord` int DEFAULT '1',                   -- æ’åºæƒé‡ (è¶Šå¤§è¶Šé å‰)
  `buy_limit_num` int NOT NULL DEFAULT '0',  -- å•æ¬¡è´­ä¹°é™åˆ¶ (0=ä¸é™åˆ¶)
  `buy_prompt` text,                       -- è´­ä¹°æç¤º
  `description` text,                      -- è¯¦ç»†æè¿° (HTML)
  `type` tinyint(1) NOT NULL DEFAULT '1',  -- å•†å“ç±»å‹ (1=è‡ªåŠ¨å‘è´§ 2=äººå·¥å¤„ç†)
  `wholesale_price_cnf` text,              -- æ‰¹å‘ä»·é…ç½® (JSON)
  `other_ipu_cnf` text,                    -- è‡ªå®šä¹‰è¾“å…¥æ¡†é…ç½® (JSON)
  `api_hook` text,                         -- API å›è°ƒåœ°å€
  `is_open` tinyint(1) NOT NULL DEFAULT '1',  -- æ˜¯å¦å¯ç”¨
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,  -- è½¯åˆ é™¤
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='å•†å“è¡¨';
```

#### goods_group - å•†å“åˆ†ç±»è¡¨
```sql
CREATE TABLE `goods_group` (
  `id` int NOT NULL AUTO_INCREMENT,
  `gp_name` varchar(200) NOT NULL,         -- åˆ†ç±»åç§°
  `is_open` tinyint(1) NOT NULL DEFAULT '1',  -- æ˜¯å¦å¯ç”¨
  `ord` int NOT NULL DEFAULT '1',          -- æ’åºæƒé‡
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='å•†å“åˆ†ç±»è¡¨';
```

#### carmis - å¡å¯†è¡¨
```sql
CREATE TABLE `carmis` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `goods_id` int NOT NULL,                 -- æ‰€å±å•†å“ ID
  `status` tinyint(1) NOT NULL DEFAULT '1',  -- çŠ¶æ€ (1=æœªå”®å‡º 2=å·²å”®å‡º)
  `is_loop` tinyint(1) NOT NULL DEFAULT '0',  -- æ˜¯å¦å¾ªç¯å¡å¯† (1=æ˜¯ 0=å¦)
  `carmi` text NOT NULL,                   -- å¡å¯†å†…å®¹
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_goods_id` (`goods_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='å¡å¯†è¡¨';

-- å¾ªç¯å¡å¯†: å¯é‡å¤ä½¿ç”¨,ä¸ä¼šæ ‡è®°ä¸ºå·²å”®å‡º
-- æ™®é€šå¡å¯†: å”®å‡ºå status=2,æ— æ³•å†æ¬¡ä½¿ç”¨
```

---

### 3. è®¢å•ç®¡ç†æ¨¡å—

#### orders - è®¢å•è¡¨
```sql
CREATE TABLE `orders` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `order_sn` varchar(150) NOT NULL,        -- è®¢å•å· (å”¯ä¸€)
  `goods_id` int NOT NULL,                 -- å•†å“ ID
  `coupon_id` int DEFAULT '0',             -- ä¼˜æƒ ç  ID
  `title` varchar(200) NOT NULL,           -- è®¢å•æ ‡é¢˜
  `type` tinyint(1) NOT NULL DEFAULT '1',  -- è®¢å•ç±»å‹ (1=è‡ªåŠ¨å‘è´§ 2=äººå·¥å¤„ç†)
  `goods_price` decimal(10,2) NOT NULL DEFAULT '0.00',  -- å•†å“å•ä»·
  `buy_amount` int NOT NULL DEFAULT '1',   -- è´­ä¹°æ•°é‡
  `coupon_discount_price` decimal(10,2) NOT NULL DEFAULT '0.00',  -- ä¼˜æƒ ç ä¼˜æƒ é‡‘é¢
  `wholesale_discount_price` decimal(10,2) NOT NULL DEFAULT '0.00',  -- æ‰¹å‘ä¼˜æƒ é‡‘é¢
  `total_price` decimal(10,2) NOT NULL DEFAULT '0.00',  -- è®¢å•æ€»ä»·
  `actual_price` decimal(10,2) NOT NULL DEFAULT '0.00',  -- å®é™…æ”¯ä»˜ä»·æ ¼
  `search_pwd` varchar(200) DEFAULT '',    -- æŸ¥è¯¢å¯†ç 
  `email` varchar(200) NOT NULL,           -- ä¸‹å•é‚®ç®±
  `info` text,                             -- è®¢å•è¯¦æƒ… (JSON)
  `pay_id` int DEFAULT NULL,               -- æ”¯ä»˜é€šé“ ID
  `buy_ip` varchar(50) NOT NULL,           -- è´­ä¹°è€… IP
  `trade_no` varchar(200) DEFAULT '',      -- ç¬¬ä¸‰æ–¹æ”¯ä»˜è®¢å•å·
  `status` tinyint(1) NOT NULL DEFAULT '1',  -- è®¢å•çŠ¶æ€
  `coupon_ret_back` tinyint(1) NOT NULL DEFAULT '0',  -- ä¼˜æƒ ç æ¬¡æ•°æ˜¯å¦å›é€€
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_order_sn` (`order_sn`) USING BTREE,
  KEY `idx_goods_id` (`goods_id`) USING BTREE,
  KEY `idex_email` (`email`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='è®¢å•è¡¨';

-- è®¢å•çŠ¶æ€:
-- 1: å¾…æ”¯ä»˜
-- 2: å¾…å¤„ç†
-- 3: å¤„ç†ä¸­
-- 4: å·²å®Œæˆ
-- 5: å¤„ç†å¤±è´¥
-- 6: å¼‚å¸¸
-- -1: è¿‡æœŸ
```

---

### 4. ä¼˜æƒ ç æ¨¡å—

#### coupons - ä¼˜æƒ ç è¡¨
```sql
CREATE TABLE `coupons` (
  `id` int NOT NULL AUTO_INCREMENT,
  `discount` decimal(10,2) NOT NULL DEFAULT '0.00',  -- ä¼˜æƒ é‡‘é¢
  `is_use` tinyint(1) NOT NULL DEFAULT '1',  -- æ˜¯å¦å·²ä½¿ç”¨ (1=æœªä½¿ç”¨ 2=å·²ä½¿ç”¨)
  `is_open` tinyint(1) NOT NULL DEFAULT '1',  -- æ˜¯å¦å¯ç”¨
  `coupon` varchar(150) NOT NULL,            -- ä¼˜æƒ ç å­—ç¬¦ä¸² (å”¯ä¸€)
  `ret` int NOT NULL DEFAULT '0',            -- å‰©ä½™ä½¿ç”¨æ¬¡æ•°
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_coupon` (`coupon`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='ä¼˜æƒ ç è¡¨';
```

#### coupons_goods - ä¼˜æƒ ç å•†å“å…³è”è¡¨
```sql
CREATE TABLE `coupons_goods` (
  `id` int NOT NULL AUTO_INCREMENT,
  `goods_id` int NOT NULL,                  -- å•†å“ ID
  `coupons_id` int NOT NULL,                -- ä¼˜æƒ ç  ID
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='ä¼˜æƒ ç å…³è”å•†å“è¡¨';

-- å¤šå¯¹å¤šå…³ç³»: ä¸€ä¸ªä¼˜æƒ ç å¯ç”¨äºå¤šä¸ªå•†å“
```

---

### 5. æ”¯ä»˜é…ç½®æ¨¡å—

#### pays - æ”¯ä»˜é€šé“è¡¨
```sql
CREATE TABLE `pays` (
  `id` int NOT NULL AUTO_INCREMENT,
  `pay_name` varchar(200) NOT NULL,         -- æ”¯ä»˜åç§°
  `pay_check` varchar(50) NOT NULL,         -- æ”¯ä»˜æ ‡è¯† (å”¯ä¸€)
  `pay_method` tinyint(1) NOT NULL,         -- æ”¯ä»˜æ–¹å¼ (1=è·³è½¬ 2=æ‰«ç )
  `pay_client` tinyint(1) NOT NULL DEFAULT '1',  -- æ”¯ä»˜åœºæ™¯ (1=PC 2=æ‰‹æœº 3=å…¨éƒ¨)
  `merchant_id` varchar(200) DEFAULT NULL,  -- å•†æˆ· ID
  `merchant_key` text,                      -- å•†æˆ· KEY
  `merchant_pem` text NOT NULL,             -- å•†æˆ·è¯ä¹¦/å¯†é’¥
  `pay_handleroute` varchar(200) NOT NULL,  -- æ”¯ä»˜å¤„ç†è·¯ç”±
  `is_open` tinyint(1) NOT NULL DEFAULT '1',  -- æ˜¯å¦å¯ç”¨
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¯ä»˜é…ç½®è¡¨';

-- æ”¯ä»˜æ ‡è¯†ç¤ºä¾‹: alipay, wechat, qqpay
```

---

### 6. é‚®ä»¶æ¨¡æ¿æ¨¡å—

#### emailtpls - é‚®ä»¶æ¨¡æ¿è¡¨
```sql
CREATE TABLE `emailtpls` (
  `id` int NOT NULL AUTO_INCREMENT,
  `tpl_name` varchar(150) NOT NULL,         -- é‚®ä»¶æ ‡é¢˜
  `tpl_content` text NOT NULL,              -- é‚®ä»¶å†…å®¹ (æ”¯æŒå˜é‡æ›¿æ¢)
  `tpl_token` varchar(50) NOT NULL,         -- æ¨¡æ¿æ ‡è¯† (å”¯ä¸€)
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `mail_token` (`tpl_token`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- å†…å®¹å˜é‡ç¤ºä¾‹: {order_sn}, {goods_name}, {email}
```

---

### 7. ç³»ç»Ÿé…ç½®æ¨¡å—

#### admin_settings - ç³»ç»Ÿé…ç½®è¡¨
```sql
CREATE TABLE `admin_settings` (
  `slug` varchar(100) NOT NULL,             -- é…ç½®é”® (ä¸»é”®)
  `value` longtext NOT NULL,                -- é…ç½®å€¼ (JSON æ ¼å¼)
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`slug`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- ç¤ºä¾‹:
-- slug: 'site_name' â†’ value: '"ç‹¬è§’å…½å¡ç½‘"'
-- slug: 'email_config' â†’ value: '{"host":"smtp.qq.com", "port":465}'
```

#### failed_jobs - å¤±è´¥ä»»åŠ¡é˜Ÿåˆ—è¡¨
```sql
CREATE TABLE `failed_jobs` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) NOT NULL,
  `connection` text NOT NULL,
  `queue` text NOT NULL,
  `payload` longtext NOT NULL,
  `exception` longtext NOT NULL,
  `failed_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `failed_jobs_uuid_unique` (`uuid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Laravel é˜Ÿåˆ—ä»»åŠ¡å¤±è´¥è®°å½•
```

---

## äº”ã€è¡¨å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   admin_users   â”‚ (ç®¡ç†å‘˜)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ many-to-many
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚admin_rolesâ”‚ (è§’è‰²)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚ many-to-many
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚admin_permissionsâ”‚ (æƒé™)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚goods_group   â”‚ 1     N â”‚   goods     â”‚ (å•†å“)
â”‚(å•†å“åˆ†ç±»)    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ 1
                                â”‚
                                â”‚ N
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     orders     â”‚ (è®¢å•)
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   coupons    â”‚ N     N â”‚    goods    â”‚
â”‚  (ä¼˜æƒ ç )    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1
      â”‚
      â”‚ N
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚coupons_goods   â”‚ (å…³è”è¡¨)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€è½¯åˆ é™¤å­—æ®µ

ä»¥ä¸‹è¡¨åŒ…å« `deleted_at` å­—æ®µ,æ”¯æŒ**è½¯åˆ é™¤**:

| è¡¨å | ç”¨é€” |
|------|------|
| goods | å•†å“åˆ é™¤ |
| goods_group | åˆ†ç±»åˆ é™¤ |
| carmis | å¡å¯†åˆ é™¤ |
| coupons | ä¼˜æƒ ç åˆ é™¤ |
| orders | è®¢å•åˆ é™¤ |
| pays | æ”¯ä»˜é€šé“åˆ é™¤ |
| emailtpls | é‚®ä»¶æ¨¡æ¿åˆ é™¤ |

**è½¯åˆ é™¤åŸç†**:
- åˆ é™¤æ—¶ä¸çœŸåˆ ,åªè®¾ç½® `deleted_at = NOW()`
- æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤ `WHERE deleted_at IS NULL`
- å¯é€šè¿‡ `withTrashed()` æŸ¥è¯¢å·²åˆ é™¤è®°å½•
- å¯é€šè¿‡ `restore()` æ¢å¤åˆ é™¤

---

## ä¸ƒã€å…³é”®ç´¢å¼•

| è¡¨å | ç´¢å¼• | ç”¨é€” |
|------|------|------|
| admin_users | username | ç™»å½•æŸ¥è¯¢ |
| admin_roles | slug | è§’è‰²æ ‡è¯† |
| admin_permissions | slug | æƒé™æ ‡è¯† |
| orders | order_sn | è®¢å•æŸ¥è¯¢ |
| orders | goods_id | æŒ‰å•†å“æŸ¥è®¢å• |
| orders | email | æŒ‰é‚®ç®±æŸ¥è®¢å• |
| coupons | coupon | ä¼˜æƒ ç æŸ¥è¯¢ |
| carmis | goods_id | æŒ‰å•†å“æŸ¥å¡å¯† |
| emailtpls | tpl_token | æ¨¡æ¿æ ‡è¯† |

---

## å…«ã€ä¸ºä»€ä¹ˆä¸ç”¨ Laravel Migrations?

| å¯¹æ¯”é¡¹ | Laravel Migrations | æœ¬é¡¹ç›® (SQL æ–‡ä»¶) |
|--------|-------------------|------------------|
| æ–‡ä»¶ä½ç½® | `database/migrations/` | `database/sql/install.sql` |
| æ‰§è¡Œæ–¹å¼ | `php artisan migrate` | `DB::unprepared(file_get_contents('install.sql'))` |
| é€‚ç”¨åœºæ™¯ | å¼€å‘ä¸­,é¢‘ç¹å˜æ›´ | ä¸€æ¬¡æ€§å®‰è£…,ç¨³å®šåå°‘å˜æ›´ |
| ä¼˜ç‚¹ | ç‰ˆæœ¬æ§åˆ¶,å¯å›æ»š | ç®€å•ç›´è§‚,æ˜“ç†è§£ |
| ç¼ºç‚¹ | éœ€è¦å‘½ä»¤è¡Œæƒé™ | æ— æ³•ç‰ˆæœ¬æ§åˆ¶,éš¾å›æ»š |
| é¡¹ç›®ç‰¹ç‚¹ | - | Web å®‰è£…å‘å¯¼,é¢å‘éæŠ€æœ¯ç”¨æˆ· |

**é€‰æ‹©åŸå› **:
1. âœ… Web å®‰è£…å‘å¯¼ - ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å®Œæˆå®‰è£…
2. âœ… æ— éœ€å‘½ä»¤è¡Œ - å…±äº«ä¸»æœºä¹Ÿèƒ½éƒ¨ç½²
3. âœ… ç”¨æˆ·å‹å¥½ - éæŠ€æœ¯ç”¨æˆ·ä¹Ÿèƒ½ç†è§£ SQL
4. âœ… ä¸€æ¬¡æ€§åˆå§‹åŒ– - è¡¨ç»“æ„å®‰è£…ååŸºæœ¬ä¸å˜

---

## ä¹ã€å¿«é€ŸæŸ¥è¯¢

### æŸ¥çœ‹æ‰€æœ‰è¡¨
```sql
SHOW TABLES;
```

### æŸ¥çœ‹è¡¨ç»“æ„
```sql
DESC goods;
SHOW CREATE TABLE goods;
```

### æŸ¥çœ‹è¡¨å…³ç³»
```sql
-- æŸ¥çœ‹å•†å“åŠå…¶åˆ†ç±»
SELECT g.*, gp.gp_name
FROM goods g
LEFT JOIN goods_group gp ON g.group_id = gp.id;

-- æŸ¥çœ‹è®¢å•åŠå•†å“
SELECT o.*, g.gd_name
FROM orders o
LEFT JOIN goods g ON o.goods_id = g.id;
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-01-01
**é¡¹ç›®**: ç‹¬è§’å…½å¡ç½‘ (dujiaoka)
